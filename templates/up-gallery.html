{% include 'header.html' %}
<link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style-upgallery.css') }}">

<section class="ftco-section bg-light" data-section="gallery">
  <div class="container">
    <div class="row justify-content-center pb-5">
      <div class="col-md-7 heading-section text-center ftco-animate">
        <span class="subheading">Gallery</span>
        <h2 class="mb-4">Our Gallery</h2>
        <p>Jelajahi galeri kami untuk melihat foto dan media menawan dari acara komunitas kami.
          Ruang ini juga memamerkan karya seni yang dibuat oleh penggemar dan peminat JKT48.</p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 testimonial">
        <div class="carousel-project owl-carousel">
          {% for item in fan_art_items %}
          <div class="item">
            <div class="project">
              <div class="img">
                <img src="{{ item.image }}" class="img-fluid" alt="Colorlib Template">
                <a href="{{ item.image }}"
                  class="icon image-popup d-flex justify-content-center align-items-center">
                  <span class="icon-expand"></span>
                </a>
              </div>
              <div class="text px-4">
                <h3><a href="#">{{ item.title }}</a></h3>
                <span>{{ item.category }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
          {% for item in fjkt_items %}
          <div class="item">
            <div class="project">
              <div class="img">
                <img src="{{ item.image }}" class="img-fluid" alt="Colorlib Template">
                <a href="{{ item.image }}"
                  class="icon image-popup d-flex justify-content-center align-items-center">
                  <span class="icon-expand"></span>
                </a>
              </div>
              <div class="text px-4">
                <h3><a href="#">{{ item.title }}</a></h3>
                <span>{{ item.category }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
          {% for item in fan_art_items %}
          <div class="item">
            <div class="project">
              <div class="img">
                <img src="{{ item.image }}" class="img-fluid" alt="Colorlib Template">
                <a href="{{ item.image }}"
                  class="icon image-popup d-flex justify-content-center align-items-center">
                  <span class="icon-expand"></span>
                </a>
              </div>
              <div class="text px-4">
                <h3><a href="#">{{ item.title }}</a></h3>
                <span>{{ item.category }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
          {% for item in fjkt_items %}
          <div class="item">
            <div class="project">
              <div class="img">
                <img src="{{ item.image }}" class="img-fluid" alt="Colorlib Template">
                <a href="{{ item.image }}"
                  class="icon image-popup d-flex justify-content-center align-items-center">
                  <span class="icon-expand"></span>
                </a>
              </div>
              <div class="text px-4">
                <h3><a href="#">{{ item.title }}</a></h3>
                <span>{{ item.category }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
          {% for item in fan_art_items %}
          <div class="item">
            <div class="project">
              <div class="img">
                <img src="{{ item.image }}" class="img-fluid" alt="Colorlib Template">
                <a href="{{ item.image }}"
                  class="icon image-popup d-flex justify-content-center align-items-center">
                  <span class="icon-expand"></span>
                </a>
              </div>
              <div class="text px-4">
                <h3><a href="#">{{ item.title }}</a></h3>
                <span>{{ item.category }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
          {% for item in fjkt_items %}
          <div class="item">
            <div class="project">
              <div class="img">
                <img src="{{ item.image }}" class="img-fluid" alt="Colorlib Template">
                <a href="{{ item.image }}"
                  class="icon image-popup d-flex justify-content-center align-items-center">
                  <span class="icon-expand"></span>
                </a>
              </div>
              <div class="text px-4">
                <h3><a href="#">{{ item.title }}</a></h3>
                <span>{{ item.category }}</span>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="row justify-content-center mb-5">
      <div class="col-md-7 heading-section text-center ftco-animate">
        <div class="button-container">
          <button id="gallery-button">
            <span style="margin-right: 5px;">GALLERY</span>
            <i class="fas fa-plus-circle"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="row justify-content-center align-items-center vh-100 mb-5" id="gallery-options" style="display: none;">
      <div class="col-md-7 heading-section text-center ftco-animate">
        <div class="buttons-container">
          <button id="fjkt-button" onclick="selectCategory('FJKT')">
            <span style="margin-right: 5px;">FJKT</span>
            <i class="fas fa-plus-circle"></i>
          </button>
          <button id="fan-art-button" onclick="selectCategory('FAN ART')">
            <span style="margin-right: 5px;">FAN ART</span>
            <i class="fas fa-plus-circle"></i>
          </button>
        </div>
      </div>
    </div>
    <div>
      <h3 class="centered-bold" id="target-section" style="margin-bottom: 4rem;">FJKT</h3>
    </div>
    <div class="row px-2 mt-4 gap-3" id="filterable-cards" style="margin-bottom: 3rem;">
      {% for item in fjkt_items %}
      <div class="col-md-4 ftco-animate">
        <div class="blog-entry justify-content-end">
          <a href="#" data-toggle="modal" data-target="#myModal" class="block-20">
            <img src="{{ item.image }}" style="max-width: 350px;" alt="Image">
          </a>
          <div class="text mt-3 float-right d-block">
            <div class="d-flex align-items-center pt-2 mb-4 topp">
              <div class="one mr-3">
                <span class="day">{{ item.day }}</span>
              </div>
              <div class="two">
                <span class="yr">{{ item.year }}</span>
                <span class="mos">{{ item.month }}</span>
              </div>
            </div>
            <h3 class="heading"><a href="#" data-toggle="modal" data-target="#myModal">{{ item.title }}</a></h3>
            <p>{{ item.description }}</p>
            <div class="d-flex align-items-center mt-4 meta">
              <p class="mb-0">
                <a href="#" class="btn btn-secondary" onclick="confirmDelete('{{ item._id }}')">
                  <span class="ion-ios-trash"></span> Hapus
                </a>
              </p>
              <p class="ml-auto mb-0">
                <a href="#" class="mr-2"
                  onclick="openEditModal('{{ item._id }}', '{{ item.title }}', '{{ item.description }}', '{{ item.category }}', '{{ item.image }}')">
                  <span class="ion-ios-create"></span> Edit
                </a>
                <a href="#" class="mr-2" onclick="toggleArchive('{{ item._id }}', '{{ item.category }}')">
                  <span class="{{ 'ion-ios-archive' if not item.archived else 'ion-ios-unarchive' }}"></span>
                  {{ 'Arsipkan' if not item.archived else 'Un-Arsipkan' }}
                </a>
              </p>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div>
      <h3 class="centered-bold" id="fan-section" style="margin-bottom: 4rem;">FAN ART</h3>
    </div>
    <div class="row px-2 mt-4 gap-3" id="filterable-cards">
      {% for item in fan_art_items %}
      <div class="col-md-4 ftco-animate">
        <div class="blog-entry justify-content-end">
          <a href="#" data-toggle="modal" data-target="#myModal" class="block-20">
            <img src="{{ item.image }}" style="max-width: 350px;" alt="Image">
          </a>
          <div class="text mt-3 float-right d-block">
            <div class="d-flex align-items-center pt-2 mb-4 topp">
              <div class="one mr-3">
                <span class="day" style="color: steelblue;">{{ item.day }}</span>
              </div>
              <div class="two">
                <span class="yr" style="color: steelblue;">{{ item.year }}</span>
                <span class="mos" style="color: steelblue;">{{ item.month }}</span>
              </div>
            </div>
            <h3 class="heading"><a href="#" data-toggle="modal" data-target="#myModal">{{ item.title }}</a></h3>
            <p>{{ item.description }}</p>
            <div class="d-flex align-items-center mt-4 meta">
              <p class="mb-0">
                <a href="#" class="btn btn-secondary" onclick="confirmDelete('{{ item._id }}')">
                  <span class="ion-ios-trash"></span> Hapus
                </a>
              </p>
              <p class="ml-auto mb-0">
                <a href="#" class="mr-2"
                  onclick="openEditModal('{{ item._id }}', '{{ item.title }}', '{{ item.description }}', '{{ item.category }}', '{{ item.image }}')">
                  <span class="ion-ios-create"></span> Edit
                </a>
                <a href="#" class="mr-2" onclick="toggleArchive('{{ item._id }}', '{{ item.category }}')">
                  <span class="{{ 'ion-ios-archive' if not item.archived else 'icon ion-ios-share' }}"></span>
                  {{ 'Arsipkan' if not item.archived else 'Un-Arsipkan' }}
                </a>
              </p>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

  </div>
</section>
<!-- Modal for FJKT -->
<div id="fjkt-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div class="modal-inner">
      <div class="form-container">
        <h2>Form Input FJKT</h2>
        <form id="fjkt-form" action="{{ url_for('submitgallery') }}" method="post" enctype="multipart/form-data">
          <input type="hidden" id="fjkt-category-input" name="category" value="FJKT">
          <div class="form-group">
            <label for="fjkt-name">Judul:</label>
            <input type="text" id="fjkt-name" name="fjkt-name" required>
          </div>
          <div class="form-group">
            <label for="fjkt-description">Deskripsi:</label>
            <input type="text" id="fjkt-description" name="fjkt-description" required>
          </div>
          <div class="form-group">
            <label for="fjkt-image">Gambar:</label>
            <input type="file" id="fjkt-image" name="fjkt-image" accept="image/*" required>
          </div>
          <button type="button" id="fjkt-clear">Clear</button>
        </form>
      </div>
      <div class="detail-container">
        <h2>Detail FJKT</h2>
        <div id="fjkt-detail">
          <p>Judul: <span id="fjkt-detail-name"></span></p>
          <p>Deskripsi: <span id="fjkt-detail-description"></span></p>
          <img id="fjkt-detail-image-preview" src="#" alt="Preview Gambar">
        </div>
        <button type="submit" form="fjkt-form" id="fjkt-save">Simpan</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Fan Art -->
<div id="fan-art-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div class="modal-inner">
      <div class="form-container">
        <h2>Form Input Fan Art</h2>
        <form id="fan-art-form" action="{{ url_for('submitgallery') }}" method="post" enctype="multipart/form-data">
          <input type="hidden" id="fan-art-category-input" name="category" value="FAN ART">
          <div class="form-group">
            <label for="fan-art-title">Judul:</label>
            <input type="text" id="fan-art-title" name="fan-art-title" required>
          </div>
          <div class="form-group">
            <label for="fan-art-description">Deskripsi:</label>
            <input type="text" id="fan-art-description" name="fan-art-description" required>
          </div>
          <div class="form-group">
            <label for="fan-art-image">Gambar:</label>
            <input type="file" id="fan-art-image" name="fan-art-image" accept="image/*" required>
          </div>
          <button type="button" id="fan-art-clear">Clear</button>
        </form>
      </div>
      <div class="detail-container">
        <h2>Detail Fan Art</h2>
        <div id="fan-art-detail">
          <p>Judul: <span id="fan-art-detail-title"></span></p>
          <p>Deskripsi: <span id="fan-art-detail-description"></span></p>
          <img id="fan-art-detail-image-preview" src="#" alt="Preview Gambar">
        </div>
        <button type="submit" form="fan-art-form" id="fan-art-save">Simpan</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Edit (FJKT and Fan Art) -->
<div id="edit-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeEditModal()">&times;</span>
    <div class="modal-inner">
      <div class="form-container">
        <h2>Edit Item</h2>
        <form id="edit-form" action="editgallery" method="post" enctype="multipart/form-data">
          <input type="hidden" id="edit-item-id" name="item_id" value="">
          <input type="hidden" id="current-image-path" name="current_image_path" value="">
          <div class="form-group">
            <label for="edit-name">Judul:</label>
            <input type="text" id="edit-name" name="edit-name" required>
          </div>
          <div class="form-group">
            <label for="edit-description">Deskripsi:</label>
            <input type="text" id="edit-description" name="edit-description" required>
          </div>
          <div class="form-group">
            <label for="edit-image">Gambar:</label>
            <input type="file" id="edit-image" name="edit-image" accept="image/*" onchange="previewImage(event)">
          </div>
          <div class="form-group">
            <label for="edit-category">Kategori:</label>
            <select id="edit-category" name="edit-category">
              <option value="FJKT">FJKT</option>
              <option value="Fan Art">Fan Art</option>
            </select>
          </div>
          <button type="button" id="edit-clear" onclick="clearEditForm()">Clear</button>
        </form>
      </div>
      <div class="detail-container">
        <h2>Detail Item</h2>
        <div id="edit-detail">
          <p>Judul: <span id="edit-detail-name"></span></p>
          <p>Deskripsi: <span id="edit-detail-description"></span></p>
          <p>Kategori: <span id="edit-detail-category"></span></p>
          <img id="edit-detail-image-preview" src="#" alt="Preview Gambar" style="max-width: 100%;">
        </div>
        <button type="submit" form="edit-form" id="edit-save">Simpan</button>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Tampilkan modal pilihan galeri saat tombol GALLERY diklik
    const galleryButton = document.getElementById('gallery-button');
    const galleryOptions = document.getElementById('gallery-options');

    galleryButton.addEventListener('click', function () {
      galleryOptions.style.display = 'flex';
    });

    // Tampilkan modal FJKT saat tombol FJKT diklik
    const fjktButton = document.getElementById('fjkt-button');
    fjktButton.addEventListener('click', function () {
      selectCategory('FJKT'); // Panggil fungsi untuk menampilkan modal FJKT
    });

    // Tampilkan modal Fan Art saat tombol Fan Art diklik
    const fanArtButton = document.getElementById('fan-art-button');
    fanArtButton.addEventListener('click', function () {
      selectCategory('FAN ART'); // Panggil fungsi untuk menampilkan modal Fan Art
    });

    function selectCategory(category) {
      // Ubah nilai input hidden dengan nama 'category' sesuai dengan kategori yang dipilih
      if (category === 'FJKT') {
        document.getElementById('fjkt-category-input').value = category;
        document.getElementById('fjkt-modal').style.display = 'block';
      } else if (category === 'FAN ART') {
        document.getElementById('fan-art-category-input').value = category;
        document.getElementById('fan-art-modal').style.display = 'block';
      }
    }

    document.addEventListener('click', function (event) {
      const isClickInside = galleryOptions.contains(event.target) || galleryButton.contains(event.target);
      if (!isClickInside) {
        galleryOptions.style.display = 'none';
      }
    });

    galleryOptions.addEventListener('mouseenter', function () {
      galleryOptions.style.display = 'flex';
    });

    galleryOptions.addEventListener('mouseleave', function () {
      galleryOptions.style.display = 'none';
    });

    // Get the modals
    var fjktModal = document.getElementById("fjkt-modal");
    var fanArtModal = document.getElementById("fan-art-modal");

    // Get the <span> elements that close the modals
    var closeButtons = document.getElementsByClassName("close");

    // When the user clicks on <span> (x), close the modals
    for (var i = 0; i < closeButtons.length; i++) {
      closeButtons[i].onclick = function () {
        this.parentElement.parentElement.style.display = "none";
      }
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
      if (event.target == fjktModal) {
        fjktModal.style.display = "none";
      }
      if (event.target == fanArtModal) {
        fanArtModal.style.display = "none";
      }
    }

    // Ambil elemen-elemen input dan gambar yang perlu di-reset
    var fjktNameInput = document.getElementById("fjkt-name");
    var fjktDescriptionInput = document.getElementById("fjkt-description");
    var fjktImageInput = document.getElementById("fjkt-image");
    var fjktDetailName = document.getElementById("fjkt-detail-name");
    var fjktDetailDescription = document.getElementById("fjkt-detail-description");
    var fjktDetailImagePreview = document.getElementById("fjkt-detail-image-preview");

    // Ambil tombol "Clear"
    var fjktClearButton = document.getElementById("fjkt-clear");

    // Tambahkan event listener untuk tombol "Clear"
    fjktClearButton.addEventListener('click', function () {
      // Hapus nilai dari input teks
      fjktNameInput.value = "";
      fjktDescriptionInput.value = "";

      // Reset preview gambar
      fjktDetailImagePreview.src = "#";
      fjktDetailImagePreview.alt = "Preview Gambar";
    });

    // Get form input elements for Fan Art
    var fanArtTitleInput = document.getElementById("fan-art-title");
    var fanArtDescriptionInput = document.getElementById("fan-art-description");
    var fanArtImageInput = document.getElementById("fan-art-image");
    var fanArtDetailTitle = document.getElementById("fan-art-detail-title");
    var fanArtDetailDescription = document.getElementById("fan-art-detail-description");
    var fanArtDetailImagePreview = document.getElementById("fan-art-detail-image-preview");

    // Add event listeners for FJKT form inputs
    fjktNameInput.addEventListener('input', updateFjktDetail);
    fjktDescriptionInput.addEventListener('input', updateFjktDetail);
    fjktImageInput.addEventListener('change', previewFjktImage);

    // Add event listeners for Fan Art form inputs
    fanArtTitleInput.addEventListener('input', updateFanArtDetail);
    fanArtDescriptionInput.addEventListener('input', updateFanArtDetail);
    fanArtImageInput.addEventListener('change', previewFanArtImage);

    // Function to update FJKT detail section
    function updateFjktDetail() {
      fjktDetailName.textContent = fjktNameInput.value;
      fjktDetailDescription.textContent = fjktDescriptionInput.value;
    }

    // Function to preview selected FJKT image
    function previewFjktImage(event) {
      var file = event.target.files[0];
      var reader = new FileReader();
      reader.onload = function () {
        fjktDetailImagePreview.src = reader.result;
      }
      reader.readAsDataURL(file);
    }

    // Function to update Fan Art detail section
    function updateFanArtDetail() {
      fanArtDetailTitle.textContent = fanArtTitleInput.value;
      fanArtDetailDescription.textContent = fanArtDescriptionInput.value;
    }

    // Function to preview selected Fan Art image
    function previewFanArtImage(event) {
      var file = event.target.files[0];
      var reader = new FileReader();
      reader.onload = function () {
        fanArtDetailImagePreview.src = reader.result;
      }
      reader.readAsDataURL(file);
    }
  });
  function confirmDelete(itemId) {
    Swal.fire({
      title: "Apakah Anda yakin?",
      text: "Anda tidak akan bisa mengembalikan ini!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Ya, hapus!"
    }).then((result) => {
      if (result.isConfirmed) {
        // Mengirimkan permintaan POST untuk menghapus item
        fetch(`/deletegallery/${itemId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
          })
          .then(response => {
            if (response.ok) {
              Swal.fire({
                title: "Terhapus!",
                text: "Item Anda telah dihapus.",
                icon: "success"
              }).then(() => {
                // Refresh halaman atau lakukan tindakan lain setelah penghapusan berhasil
                window.location.reload();
              });
            } else {
              Swal.fire({
                title: "Gagal!",
                text: "Item Anda tidak dapat dihapus.",
                icon: "error"
              });
            }
          });
      }
    });
  }

  function openEditModal(id, title, description, category, image) {
    document.getElementById('edit-item-id').value = id;
    document.getElementById('edit-name').value = title;
    document.getElementById('edit-description').value = description;
    document.getElementById('edit-category').value = category;
    document.getElementById('current-image-path').value = image;

    document.getElementById('edit-detail-name').innerText = title;
    document.getElementById('edit-detail-description').innerText = description;
    document.getElementById('edit-detail-category').innerText = category;
    document.getElementById('edit-detail-image-preview').src = image ?
      `static/assets/img/gallery/${category.toLowerCase()}/${image}` : '#';

    document.getElementById('edit-modal').style.display = 'block';
  }

  function closeEditModal() {
    document.getElementById('edit-modal').style.display = 'none';
  }

  function clearEditForm() {
    document.getElementById('edit-form').reset();
  }

  function previewImage(event) {
    const output = document.getElementById('edit-detail-image-preview');
    output.src = URL.createObjectURL(event.target.files[0]);
  }

  document.getElementById('edit-form').onsubmit = function (event) {
    event.preventDefault();
    const formData = new FormData(this);
    fetch(`/editgallery`, {
      method: 'POST',
      body: formData
    }).then(response => {
      if (response.ok) {
        Swal.fire({
          title: "Berhasil!",
          text: "Item Anda telah diperbarui.",
          icon: "success"
        }).then(() => {
          window.location.reload();
        });
      } else {
        Swal.fire({
          title: "Gagal!",
          text: "Item Anda tidak dapat diperbarui.",
          icon: "error"
        });
      }
    });
  }

  function toggleArchive(itemId, category) {
    fetch(`/archive_item/${itemId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          category: category
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          Swal.fire({
            title: data.archived ? "Diarsipkan!" : "Di-unarsipkan!",
            text: data.archived ? "Item telah diarsipkan." : "Item telah di-unarsipkan.",
            icon: "success"
          }).then(() => {
            window.location.reload();
          });
        } else {
          Swal.fire({
            title: "Gagal!",
            text: "Tidak dapat mengubah status item.",
            icon: "error"
          });
        }
      });
  }
</script>
{% include 'footer.html' %}